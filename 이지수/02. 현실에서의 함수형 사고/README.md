## 변경 가능성에 따라 코드 나누기

> **계층형 설계(stratified design)**
> 아래에 있는 것을 기반으로 구현
> 일반적으로 비즈니스 규칙, 도메인 규칙, 기술 스택 계층으로 나눔
> 테스트, 재사용, 유지보수가 쉬움

맨 아래에는 자주 바뀌지 않는 기술 스택,
가운데에는 바뀔 수도 있지만 자주 바뀌지 않는 도메인 규칙,
맨 위에는 자주 바뀌는 비즈니스 규칙,

## 주방 자동화 하기

로봇 1대가 치즈 피자 만들기

```
주문접수 → 반죽 만들기 → 반죽 펴기 → 소스 만들기 → 소스 뿌리기 → 치즈 갈기 → 치즈 뿌리기 → 오븐에 넣기 → 10분 기다리기 → 서빙
```

## 분산 시스템으로 타임라인 시각화 하기

3대의 로봇이 함께 일하는 분산 시스템을 이용해 피자 만들기

```
로봇 1: 반죽 만들기
로봇 2: 치즈 갈기
로봇 3: 소스 만들기 → 반죽 펴기 → 소스 뿌리기 → 치즈 뿌리기 → 오븐에 넣기 → 10분 기다리기 → 서빙
```

반죽 만들기, 치즈 갈기, 소스 만들기의 완료 시점을 보장할 수 없어 엉뚱한 피자가 만들어질 수 있음
타임라인을 서로 맞추지 않은 분산 시스템은 예측 불가능한 순서로 실행됨
반죽, 치즈, 소스 준비가 끝나면 피자를 만들도록 해야함

## 타임라인 커팅: 로봇이 서로를 기다릴 수 있게 하기

> **타임라인 커팅**
> 타임라인이 동시에 진행될 때 순서를 맞추는 방법

고차 동작(high-order operation)으로 구현
각 타임라인은 독립적으로 동작하고 작업이 완료되면 다른 타임라인이 끝나기를 기다리기 때문에 어떤 타임라인이 먼저 끝나도 상관없음

```
로봇 1: 반죽 만들기 |
로봇 2: 치즈 갈기 |
로봇 3: 소스 만들기 | → 반죽 펴기 → 소스 뿌리기 → 치즈 뿌리기 → 오븐에 넣기 → 10분 기다리기 → 서빙
```

컷(|)이 있으면 앞에 작업(반죽 만들기, 치즈 갈기, 소스 만들기)이 끝나야 뒤에 작업(반죽 펴기)을 실행할 수 있음

## 타임라인에 대해 배운 것

1. 타임라인 커팅으로 서로 다른 작업들을 쉽게 이해할 수 있음
2. 타임라인 다이어그램을 사용하면 **시간에 따라 진행하는 작업을 쉽게 이해**할 수 있음
   동시에 실행되는 분산 시스템을 시각화 하기에 좋음
3. 타임라인 다이어그램은 유연함

## 요점 정리

- 함수형 프로그래머는 유지보수를 잘 하기 위해 **계층형 설계**를 사용하며 각 계층은 **코드의 변경 가능성에 따라** 나눔
- **타임라인 다이어그램**은 시간에 따라 **액션을 시각화** 하는 방법으로 액션이 다른 액션과 **어떻게 연결**되는지 볼 수 있음
- 액션 간 협력을 위해 **타임라인 커팅**이라는 기술을 사용하는데 이는 액션을 **올바른 순서로 실행**할 수 있도록 보장
