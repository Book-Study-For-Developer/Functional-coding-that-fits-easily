# 15. 타임라인 격리하기

- [타임라인 다이어그램 기본 규칙](#타임라인-다이어그램-기본-규칙)
- [타임라인 그리기 단계](#타임라인-그리기-단계)
- [좋은 타임라인의 원칙](#좋은-타임라인의-원칙)
- [언어별 스레드 모델](#언어별-스레드-모델)
- [비동기 호출에서 명시적 출력 위해 콜백 사용할 수 있음](#비동기-호출에서-명시적-출력-위해-콜백-사용할-수-있음)

## 타임라인 다이어그램 기본 규칙

1. 액션은 순서대로 실행되거나 동시에 실행됨
2. 순새도 실행되는 액션은 같은 타임라인에서 하나가 끝나면 다른 하나가 실행됨 - 두 액션이 순서대로 나타나면 같은 타임라인에 넣음
3. 동시에 실행되는 액션은 여러 타임라인에서 나란히 실행됨 - 두 액션이 동시에 실행되거나 순서를 예상할 수 없다면 분리된 타임라인에 넣음

---

## 타임라인 그리기 단계

1. 액션 확인
    - 놓칠 수 있는 액션 순서
        1. ++와 +=는 사실 세 단계임
            
            ```tsx
            total++
            
            var temp = total // 읽기 (액션)
            temp = temp + 1 // 더하기 (계산)
            total = temp // 쓰기 (액션)
            ```
            
        2. 인자는 함수를 부르기 전에 실행함
            
            ```tsx
            // 1. 전역변수 total 읽기
            // 2. 로그 찍기
            console.log(total)
            ```
            
2. 순서대로 실행되거나 동시에 실행되는 액션 그림
    - 순서대로 실행되는 액션: 하나가 끝나고 다음이 시작
    - 동시에 실행되는 액션: 동시에 실행되거나 왼쪽 먼저 또는 오른쪽 먼저 실행 (같은 라인 아닌 타임라인은 순서 보장 불가)
3. 플랫폼에 특화된 지식 사용해 다이어그램을 단순하게 만듦
    - 하나의 타임라인에 있는 모든 액션을 하나로 통합. 순서가 섞이지 않는 액션은 하나의 박스로 합침
    - 타임라인 끝에서 새로운 타임라인이 하나만 생긴다면 하나로 합침
    - 순서에 제약이 있는 경우 점선 추가

---


## 좋은 타임라인의 원칙

1. 타임라인은 적을수록 이해하기 쉬움
2. 타임라인은 짧을수록 이해하기 쉬움
3. 공유하는 자원이 적을 수록 이해하기 쉬움
4. 자원을 공유한다면 서로 조율해야 함 - 올바른 결과를 주지 않는 실행 순서를 없앰
5. 시간을 일급으로 다룸

---


## 언어별 스레드 모델

- 단일 스레드, 동기
    - PHP
    - 모든것이 순서대로 시행. 입출력 사용하면 끝날 때까지 기다려야 함
    - 시스템이 단순. 스레드가 하나면 타임라인도 하나. 네트워크 통한 API 호출 같은 것은 다른 타임라인이 필요하나 메모리 공유하지 않기에 공유 자원 많이 없앨 수 있음.
- 단일 스레드, 비동기
    - JS
    - 입출력 작업은 비동기 모델 사용. 입출력 결과는 콜백으로 받을 수 있지만 언제 끝날지 알 수 없기에 다른 타임라인에 표현해야
    - `이벤트 루프` 스레드에서 코드 실행. 가장 앞에 있는 작업 처리하고 다음 작업 처리.
    - `작업 큐`는 이벤트 루프에 의해 처리됨. 비동기 콜백 등.
- 멀티 스레드
    - 자바, 파이썬, 루비, C, C#
    - 실행 순서를 보장하지 않기에 프로그래밍하기 어려움
    - 새로운 스레드가 생기면 새로운 타임라인을 그려야 함
- 메시지 패싱 프로세스
    - 엘릭서, 얼랭
    - 서로 다른 프로세스를 동시에 실행할 수 있는 스레드 모델
    - 프로세스는 서로 메모리 공유하지 않고 메시지로 통신
    - 서로 다른 타임라인에 있는 액션은 순서가 섞이지만 메모리 공유하지 않기에 가능한 실행 순서가 많아도 문제 되지 않음.

---


## 비동기 호출에서 명시적 출력 위해 콜백 사용할 수 있음

- 동기 함수
    - 호출하는 곳에서 **리턴값** 사용 가능
    - 액션을 빼내기 위해 액션을 부르는 곳을 리턴값으로 바꾸고 액션에 리턴값을 인자로 전달함
- 비동기 함수
    - 미래에 어떤 시점에 **콜백**을 통해 결과 받음
    - 액션을 빼내기 위해 액션을 부르는 곳을 콜백을 부르도록 바꾸고 액션을 콜백으로 전달함
